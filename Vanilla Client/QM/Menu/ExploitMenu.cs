using MelonLoader;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using UnityEngine;
using Vanilla.Buttons.QM;
using Vanilla.Config;
using Vanilla.Exploits;
using Vanilla.Wrappers;
using VRC;
using VRC.Core;

namespace Vanilla.QM.Menu
{

    internal class ExploitMenu
    {
        public static string backupID = "";
        public static void InitMenu(QMTabMenu tabMenu)
        {
            var ExploitMenu = new QMNestedButton(tabMenu, 2, 3, "Exploits", "Vanilla", "Vanilla Client");

            var PCCrash = new QMSingleButton(ExploitMenu, 1, 0, "Crash Lobby", delegate
            {
                Crash(MainConfig.PCCrashID);
            }, "Click me to Crash The World");

            var EarRapeButton = new QMToggleButton(ExploitMenu, 3, 0, "E1", delegate
            {
                Log("Exploits", "Earrape Enabled");
                RuntimeConfig.ShouldEarRape = true;
                MelonCoroutines.Start(EarRape.EarrapeExploit());
            }, delegate
            {
                Log("Exploits", "Earrape Disabled");
                RuntimeConfig.ShouldEarRape = false;
            }, "HAHA E1 Go Burt");


            var FlyToggle = new QMToggleButton(ExploitMenu, 2, 0, "Fly", delegate
            {
                Log("Fly", "Fly Enabled");
                RuntimeConfig.ShouldFly = true;
                VRC.Player.prop_Player_0.gameObject.GetComponent<CharacterController>().enabled = false;
            }, delegate
            {
                Log("Fly", "Fly Disabled");
                RuntimeConfig.ShouldFly = false;
                VRC.Player.prop_Player_0.gameObject.GetComponent<CharacterController>().enabled = true;
            }, "I believe i can Fly");

            var Deleteportals = new QMSingleButton(ExploitMenu, 4, 0, "DeletePortals", delegate
            {
                var array = Resources.FindObjectsOfTypeAll<PortalTrigger>();
                for (int i = 0; i < array.Length; i++)
                    if (array[i].gameObject.active)
                        GameObject.DestroyImmediate(array[i].gameObject);
            }, "Bye Bye portals");
            


            /* How to do the murder 4 hacks Implement soon 
             
                GameObject Murder = submenu.Create("Murder 4", Xploitsubmenu);
                new Submenubutton(Xploitsubmenu.GetMenu(), "Murder 4", Murder, Download_Images._XploitIcon, false, 3, 0);
                new NToggle("Self Gold Weapon", Murder.GetMenu(), () => Defiance.Settings.ConfigVars.murdergoldweapon = true, () => Defiance.Settings.ConfigVars.murdergoldweapon = false, Defiance.Settings.ConfigVars.murdergoldweapon);
                new NToggle("Everyone Gold Weapon", Murder.GetMenu(), () => Defiance.Settings.ConfigVars.everyonegoldgun = true, () => Defiance.Settings.ConfigVars.everyonegoldgun = false, Defiance.Settings.ConfigVars.everyonegoldgun);
                new NToggle("God Mode", Murder.GetMenu(), () => Defiance.Settings.ConfigVars.murdergodmod = true, () => Defiance.Settings.ConfigVars.murdergodmod = false, Defiance.Settings.ConfigVars.murdergodmod);
                new NToggle("Self No ShootC", Murder.GetMenu(), () => Defiance.Settings.ConfigVars.continuesfire = true, () => Defiance.Settings.ConfigVars.continuesfire = false, Defiance.Settings.ConfigVars.continuesfire);
                new NToggle("Everyone No ShootC", Murder.GetMenu(), () => Defiance.Settings.ConfigVars.everyonecontinuesfire = true, () => Defiance.Settings.ConfigVars.everyonecontinuesfire = false, Defiance.Settings.ConfigVars.everyonecontinuesfire);
                new NButton(Murder.GetMenu(), "Start Game", () => Defiance.Exploits.MurderMisc.MurderMod("Btn_Start"));
                new NButton(Murder.GetMenu(), "Throw Apples", () => Defiance.Exploits.MurderMisc.MurderMod("OnLocalPlayerBlinded"));
                new NButton(Murder.GetMenu(), "Abort Game", () => Defiance.Exploits.MurderMisc.MurderMod("SyncAbort"));
                new NButton(Murder.GetMenu(), "Good Apples Win", () => Defiance.Exploits.MurderMisc.MurderMod("SyncVictoryB"));
                new NButton(Murder.GetMenu(), "Bad Apples Win", () => Defiance.Exploits.MurderMisc.MurderMod("SyncVictoryM"));

            */

            /* How to do the Among Us hacks Implement soon 
             
                GameObject Among = submenu.Create("AmongUs", Xploitsubmenu);
                new Submenubutton(Xploitsubmenu.GetMenu(), "AmongUs", Among, Download_Images._XploitIcon, false, 4, 0);
                new NButton(Among.GetMenu(), "Complete Task", () => Defiance.Exploits.AmongUsMisc.AmongUsMod("OnLocalPlayerCompletedTask"));
                new NButton(Among.GetMenu(), "Crew Win", () => Defiance.Exploits.AmongUsMisc.AmongUsMod("Btn_Start"));
                new NButton(Among.GetMenu(), "Sussy Wub", () => Defiance.Exploits.AmongUsMisc.AmongUsMod("SyncVictoryM"));
                new NButton(Among.GetMenu(), "Kill All", () => Defiance.Exploits.AmongUsMisc.AmongUsMod("KillLocalPlayer"));
                new NButton(Among.GetMenu(), "Start Game", () => Defiance.Exploits.AmongUsMisc.AmongUsMod("SyncVictoryB"));
                new NButton(Among.GetMenu(), "Force Meeting", () => Defiance.Exploits.AmongUsMisc.AmongUsMod("StartMeeting"));
            
             */


            /* World History button Somthing like this 
             
            Nocturnal.Ui.qm.Worldhistory.worldhistorymenu = submenu.Create("World History", Menu);
            new Submenubutton(Menu.GetMenu(), "World History", Nocturnal.Ui.qm.Worldhistory.worldhistorymenu, Download_Images._WorldIcon, true, 2, 6);
            
             */

        }
        internal static void Crash(string AvatarID)
        {

            backupID = APIUser.CurrentUser.avatarId;

            PlayerWrapper.HideSelf(true);
            PlayerWrapper.ChangePlayerAvatar(AvatarID);
            LogHandler.Log("Crasher", $"Changed To Crash Avatar {AvatarID}");

            GeneralUtils.Delay(10, OnCrashDone);
        }
        internal static void OnCrashDone()
        {
            PlayerWrapper.ChangePlayerAvatar(backupID);
            LogHandler.Log("Crasher", $"Changed To Avatar {backupID}");
            PlayerWrapper.HideSelf(false);
          
        }
    }

}

